<!DOCTYPE html>
<html lang="en-US">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" Add psi probe to a pentaho biserver making it easier to manage and monitor &middot;  blijblijblij.github.io" />
  	<meta property="og:site_name" content="blijblijblij.github.io" />
  	<meta property="og:url" content="http://blijblijblij.github.io/post/biserver-anal-probe/" />

    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2016-08-30T00:00:00&#43;02:00" />

    
    <meta property="og:article:tag" content="pentaho" />
    
    

  <title>
     Add psi probe to a pentaho biserver making it easier to manage and monitor &middot;  blijblijblij.github.io
  </title>

    <meta name="description" content="... blablabla, linux, pentaho, docker, mesos ..." />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://blijblijblij.github.io/images/favicon.ico">
	  <link rel="apple-touch-icon" href="http://blijblijblij.github.io/images/apple-touch-icon.png" />

    <link rel="stylesheet" type="text/css" href="http://blijblijblij.github.io/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="http://blijblijblij.github.io/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />


    
      
          <link href="http://blijblijblij.github.io/index.xml" rel="alternate" type="application/rss+xml" title="blijblijblij.github.io" />
      
      
    
    <meta name="generator" content="Hugo 0.16" />

    <link rel="canonical" href="http://blijblijblij.github.io/post/biserver-anal-probe/" />

    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-77257717-1', 'auto');
      ga('send', 'pageview');

    </script>
    

    
</head>
<body class="nav-closed">

  <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        
        
        
    </ul>
    
    
    <a class="subscribe-button icon-feed" href="http://blijblijblij.github.io/index.xml">Subscribe</a>
    
</div>
<span class="nav-cover"></span>


 <div class="site-wrapper">




<header class="main-header post-head" style="background-image: url(http://blijblijblij.github.io/images/cover.jpg)">
  <nav class="main-nav overlay clearfix">


  
      <a class="blog-logo" href="http://blijblijblij.github.io/"><img src="http://blijblijblij.github.io/images/logo.png" alt="Home" /></a>
  
  
      <a class="menu-button icon-feed" href="http://blijblijblij.github.io/index.xml">&nbsp;&nbsp;Subscribe</a>
  
  </nav>
</header>



<main class="content" role="main">




  <article class="post post">

    <header class="post-header">
        <h1 class="post-title">Add psi probe to a pentaho biserver making it easier to manage and monitor</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2016-08-30T00:00:00&#43;02:00">
            Aug 30, 2016
          </time>
        
         
          <span class="post-tag small"><a href="http://blijblijblij.github.io/tags/pentaho/">#pentaho</a></span>
         
        </section>
    </header>

    <section class="post-content">
      

<h1 id="problem">Problem</h1>

<p>You have a pentaho biserver, might be integrated into a bigger architecture serving out data to other webapps. <strong>BUT</strong>, somehow its misbehaving.</p>

<p>There is a suspect: <code>functionality Y</code>, but before you bring out your <a href="https://en.wikipedia.org/wiki/Bastard_Operator_From_Hell"><code>BOFH</code> skills</a>, better make sure who is to blame (functionality wise that is of course&hellip;)</p>

<h1 id="solution-via-docker-add-psi-probe">Solution (via docker), add psi probe</h1>

<p>From their community site:</p>

<pre><code>PSI Probe is a community-driven fork of Lambda Probe distributed under the same open-source license (GPLv2). It is intended to replace and extend Tomcat Manager, making it easier to manage and monitor an instance of Apache Tomcat.

Unlike many other server monitoring tools, PSI Probe does not require any changes to your existing apps. It provides all of its features through a web-accessible interface that becomes available simply by deploying it to your server. These features include:

Requests: Monitor traffic in real-time, even on a per-application basis.
Sessions: Browse/search attributes, view last IP, expire, estimate size.
JSP: Browse, view source, compile.
Data Sources: View pool usage, execute queries.
Logs: View contents, download, change levels at runtime.
Threads: View execution stack, kill.
Connectors: Status, usage charts.
Cluster: Status, usage charts.
JVM: Memory usage charts, advise GC
Java Service Wrapper: Restart JVM.
System: CPU usage, memory usage, swap file usage.
</code></pre>

<p>Download <a href="https://github.com/psi-probe/psi-probe">psi probe.war</a></p>

<p>Create a <code>tomcat-users.xml</code></p>

<pre><code class="language-xml">&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the &quot;License&quot;); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
--&gt;
&lt;tomcat-users xmlns=&quot;http://tomcat.apache.org/xml&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot; version=&quot;1.0&quot;&gt;
    &lt;!--
  NOTE:  By default, no user is included in the &quot;manager-gui&quot; role required
  to operate the &quot;/manager/html&quot; web application.  If you wish to use this app,
  you must define such a user - the username and password are arbitrary.
--&gt;
    &lt;!--
  NOTE:  The sample user and role entries below are wrapped in a comment
  and thus are ignored when reading this file. Do not forget to remove
  &lt;!.. ..&gt; that surrounds them.
--&gt;
    &lt;!--
  &lt;role rolename=&quot;tomcat&quot;/&gt;
  &lt;role rolename=&quot;role1&quot;/&gt;
  &lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;tomcat&quot;/&gt;
  &lt;user username=&quot;both&quot; password=&quot;tomcat&quot; roles=&quot;tomcat,role1&quot;/&gt;
  &lt;user username=&quot;role1&quot; password=&quot;tomcat&quot; roles=&quot;role1&quot;/&gt;
--&gt;
    &lt;role rolename=&quot;probeuser&quot;/&gt;
    &lt;role rolename=&quot;poweruser&quot;/&gt;
    &lt;role rolename=&quot;poweruserplus&quot;/&gt;
    &lt;role rolename=&quot;manager-gui&quot;/&gt;
    &lt;user username=&quot;admin&quot; password=&quot;@@PROBE_PASSWORD@@&quot; roles=&quot;manager-gui&quot;/&gt;
&lt;/tomcat-users&gt;

</code></pre>

<p>Drop it in your tomcat instance next to the <code>pentaho webapp</code>:</p>

<pre><code class="language-bash">FROM blijblijblij/java:8

MAINTAINER Rogier Wessel

....
# Add script
ADD v6/tomcat/start-pentaho.sh ${PENTAHO_HOME}/start-pentaho.sh
ADD docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x ${PENTAHO_HOME}/start-pentaho.sh &amp;&amp; \
  chmod +x /docker-entrypoint.sh

# psi probing!
ADD v6/tomcat/conf/tomcat-users.xml /opt/pentaho/biserver-ee/tomcat/conf/tomcat-users.xml
ADD probe.war /opt/pentaho/biserver-ee/tomcat/webapps/
...

# Expose Pentaho port
EXPOSE 8080

# Expose logdir
VOLUME [&quot;/opt/pentaho/biserver-ee/tomcat/logs/&quot;]

# User
USER pentaho

CMD [&quot;/docker-entrypoint.sh&quot;]

</code></pre>

<p>Make sure <code>docker-entrypoint.sh</code> gets the externalized <code>@@PROBE_PASSWORD@@</code> :</p>

<pre><code class="language-bash">#!/bin/bash

applyconfig(){
	echo &quot;****** Applying Pentaho Config ******&quot;
	cd /opt/pentaho/biserver-ee

...

	echo &quot;--&gt; Change probe password&quot;
	sed -i 's/@@PROBE_PASSWORD@@/'${PROBE_PASSWORD}'/g' `find ./tomcat/conf -name *.xml`

...

	echo &quot;****** Finished applying Pentaho config ******&quot;
}

...

</code></pre>

<p>Start your biserver and open <code>http://ip:port/probe/</code> with your tomcat-users credentials and you have yourself an excellent insight into the jvm&rsquo;s inner workings, datasources, sessions, and what not.</p>

<p>And there it is, <code>functionality Y</code> creating sessions like mad &gt; <code>BOFH</code> quality time!</p>

<p><img src="https://raw.githubusercontent.com/blijblijblij/blijblijblij.github.io/7f16169d34a5ed72a7c4ddadba07da71564792a8/images/2016-08-30_psi_probe.png" alt="psi inteface" /></p>

    </section>


  <footer class="post-footer">


    
    <figure class="author-image">
        <a class="img" href="http://blijblijblij.github.io/" style="background-image: url(http://blijblijblij.github.io/images/logo.png)"><span class="hidden">Rogier Wessel's Picture</span></a>
    </figure>
    

    





<section class="author">
  <h4><a href="http://blijblijblij.github.io/">Rogier Wessel</a></h4>
  
  <p>Opensource Data dude, from linux to docker into the magical world of data and Pentaho. Might have eaten all red pills when it came to docker...</p>
  
  <div class="author-meta">
    <span class="author-location icon-location">Amersfoort, The Netherlands</span>
    <span class="author-link icon-link"><a href="http://blijblijblij.github.io">http://blijblijblij.github.io</a></span>
  </div>
</section>



    
<section class="share">
  <h4>Share this post</h4>
  <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Add%20psi%20probe%20to%20a%20pentaho%20biserver%20making%20it%20easier%20to%20manage%20and%20monitor&amp;url=http%3a%2f%2fblijblijblij.github.io%2fpost%2fbiserver-anal-probe%2f"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="hidden">Twitter</span>
  </a>
  <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fblijblijblij.github.io%2fpost%2fbiserver-anal-probe%2f"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="hidden">Facebook</span>
  </a>
  <a class="icon-pinterest" style="font-size: 1.4em" href="http://pinterest.com/pin/create/button/?url=http%3a%2f%2fblijblijblij.github.io%2fpost%2fbiserver-anal-probe%2f&amp;description=Add%20psi%20probe%20to%20a%20pentaho%20biserver%20making%20it%20easier%20to%20manage%20and%20monitor"
      onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;">
      <span class="hidden">Pinterest</span>
  </a>
  <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2fblijblijblij.github.io%2fpost%2fbiserver-anal-probe%2f"
     onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
      <span class="hidden">Google+</span>
  </a>
</section>



    




  </footer>
</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">blijblijblij.github.io</a> All rights reserved - 2016</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://blijblijblij.github.io/js/jquery.js"></script>
    <script type="text/javascript" src="http://blijblijblij.github.io/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://blijblijblij.github.io/js/index.js"></script>
    
</body>
</html>

